/*
  # ترحيل بيانات المستخدمين

  1. الوصف
    - ترحيل المستخدمين من البيانات الوهمية
    - 9 مستخدمين مع أدوارهم وارتباطاتهم

  2. المستخدمون
    - 1 مدير نظام
    - 6 مشرفي مؤسسات
    - 1 مندوب
    - 1 مشرف عائلة

  3. الارتباطات
    - المشرفون مرتبطون بمؤسساتهم
    - مشرف العائلة مرتبط بعائلته
    - المدير والمندوب غير مرتبطين بكيانات محددة
*/

-- إضافة حقل associated_id و associated_type إلى جدول system_users
DO $$ 
BEGIN
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_name = 'system_users' AND column_name = 'associated_id'
  ) THEN
    ALTER TABLE system_users ADD COLUMN associated_id uuid;
  END IF;
  
  IF NOT EXISTS (
    SELECT 1 FROM information_schema.columns 
    WHERE table_name = 'system_users' AND column_name = 'associated_type'
  ) THEN
    ALTER TABLE system_users ADD COLUMN associated_type text CHECK (associated_type IN ('organization', 'family'));
  END IF;
END $$;

-- المستخدمون (System Users)
INSERT INTO system_users (
  id, name, email, phone, role_id, associated_id, associated_type,
  status, last_login, created_at
) VALUES
-- مدير النظام
(
  'a0000001-0001-0001-0001-000000000001',
  'أحمد محمد الإدمن',
  'admin@humanitarian.ps',
  '0501234567',
  '00000001-0001-0001-0001-000000000001',
  NULL,
  NULL,
  'active',
  '2024-12-21',
  '2024-01-01'
),
-- مشرفة المؤسسة - الهلال الأحمر
(
  'a0000002-0002-0002-0002-000000000002',
  'فاطمة أحمد المشرفة',
  'supervisor@redcrescent-gaza.org',
  '0559876543',
  '00000002-0002-0002-0002-000000000002',
  '10000001-0001-0001-0001-000000000001',
  'organization',
  'active',
  '2024-12-20',
  '2024-01-05'
),
-- مندوب التوزيع
(
  'a0000003-0003-0003-0003-000000000003',
  'محمد علي المندوب',
  'courier@humanitarian.ps',
  '0567891234',
  '00000003-0003-0003-0003-000000000003',
  NULL,
  NULL,
  'active',
  '2024-12-21',
  '2024-01-10'
),
-- مشرفة أطباء بلا حدود
(
  'a0000004-0004-0004-0004-000000000004',
  'د. فاطمة الغزاوي - أطباء بلا حدود',
  'supervisor@msf-gaza.org',
  '0559876543',
  '00000002-0002-0002-0002-000000000002',
  '10000002-0002-0002-0002-000000000002',
  'organization',
  'active',
  '2024-12-20',
  '2024-01-05'
),
-- مشرف الإغاثة الإسلامية
(
  'a0000005-0005-0005-0005-000000000005',
  'خالد أبو يوسف - الإغاثة الإسلامية',
  'supervisor@islamic-relief.org',
  '0567891234',
  '00000002-0002-0002-0002-000000000002',
  '10000003-0003-0003-0003-000000000003',
  'organization',
  'active',
  '2024-12-19',
  '2024-01-08'
),
-- مشرف الأونروا
(
  'a0000006-0006-0006-0006-000000000006',
  'د. أحمد المدير - الأونروا',
  'supervisor@unrwa-gaza.org',
  '0591111111',
  '00000002-0002-0002-0002-000000000002',
  '10000004-0004-0004-0004-000000000004',
  'organization',
  'active',
  '2024-12-21',
  '2024-01-01'
),
-- مشرف CRS
(
  'a0000007-0007-0007-0007-000000000007',
  'جون سميث - CRS',
  'supervisor@crs-gaza.org',
  '0591234567',
  '00000002-0002-0002-0002-000000000002',
  '10000010-0010-0010-0010-000000000010',
  'organization',
  'active',
  '2024-12-20',
  '2024-01-25'
),
-- مشرف عائلة أبو عامر
(
  'a0000008-0008-0008-0008-000000000008',
  'محمد أبو عامر - رب الأسرة',
  'family@abuamer.ps',
  '0591234567',
  '00000005-0005-0005-0005-000000000005',
  '20000001-0001-0001-0001-000000000001',
  'family',
  'active',
  '2024-12-21',
  '2024-01-10'
),
-- مشرف عائلة النجار
(
  'a0000009-0009-0009-0009-000000000009',
  'أحمد النجار - رب الأسرة',
  'family@alnajjar.ps',
  '0595678901',
  '00000005-0005-0005-0005-000000000005',
  '20000002-0002-0002-0002-000000000002',
  'family',
  'active',
  '2024-12-20',
  '2024-02-05'
)
ON CONFLICT (id) DO NOTHING;
